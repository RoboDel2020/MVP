<html>
<head>
    <style>
        .logout_btn {
            font-size: 15px;
            transition: ease-in all 0.5s;
            background-color: #f5b707;
            color: #fff;
            position: fixed;
            right: 20px;
            top: 10px;
            padding: 6px 13px;
        }

            .logout_btn:hover {
                background-color: #232323;
                color: #fff;
                transition: ease-in all 0.5s;
                border-radius: 26px;
            }

        .logo_text {
            color: #f5b707;
            font-size: 30px;
            font-weight: bold;
            margin-top: 5px
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
</head>
<body>
    <div>
        <h1 class="logo_text"><a href="javascript:GoMainMenu()">RoboDel<a /></h1>
        <button class="logout_btn" type="button" onclick="Logout()">Logout</button>
        <hr>
    </div>
    <br>
    <button class="btn btn-success" type="button" style="float: right;" onclick="AddOrder()">Add Order</button>
    <br>

    <h1>Pending Orders</h1>

    <br>
    <table id="pendingOrdersTable" class="table table-bordered table-striped" style="width:100%">
        <thead>
            <tr>
                <th><b>Order ID</b></th>
                <th><b>Received At</b></th>
                <th><b>Estimated Pickup Time</b></th>
                <th><b>Ready for Pickup</b></th>
                <th><b>Status</b></th>
                <th><b>Restaurant</b></th>
                <th><b>Customer</b></th>
                <th><b>Coordinates</b></th>
            </tr>
        </thead>
        <tbody>
            @foreach (Order order in ViewBag.allPendingOrders)
            {
                <tr>
                    <td><a href="javascript:GetOrderDetails('@order.ID.ToString()')" style="color: blue">@order.ID</a></td>
                    <td>@order.DateTime</td>
                    <td>@order.PickupTime</td>

                    @if (@order.ReadyForPickup)
                    {
                        <td>Yes</td>
                    }
                    else
                    {
                        <td>No</td>
                    }
                    <td>@order.Status</td>
                    <td><a href="javascript:GetRestaurantDetails('@order.Restaurant.Email')" style="color: blue">@order.Restaurant.Name</a></td>
                    <td><a href="javascript:GetCustomerDetails('@order.Customer.ID.ToString()')" style="color: blue">@order.Customer.FirstName @order.Customer.LastName </a></td>
                    <td><button type="button" class="open-AddParkingDialog btn btn-primary" data-id="@order.ID.ToString()" data-toggle="modal" data-target="#AddParkingDialog">Add Parking</button></td>
                </tr>
            }
        <tbody>
    </table>
    <br>
    <h1>In Progress Orders</h1>

    <br>
    <table id="inProgressOrdersTable" class="table table-bordered table-striped" style="width:100%">
        <thead>
            <tr>
                <th><b>Order ID</b></th>
                <th><b>Received At</b></th>
                <th><b>Estimated Pickup Time</b></th>
                <th><b>Ready for Pickup</b></th>
                <th><b>Status</b></th>
                <th><b>Restaurant</b></th>
                <th><b>Customer</b></th>
            </tr>
        </thead>
        <tbody>
            @foreach (Order order in ViewBag.allInProgressOrders)
            {
                <tr>
                    <td><a href="javascript:GetOrderDetails('@order.ID.ToString()')" style="color: blue">@order.ID</a></td>
                    <td>@order.DateTime</td>
                    <td>@order.PickupTime</td>

                    @if (@order.ReadyForPickup)
                    {
                        <td>Yes</td>
                    }
                    else
                    {
                        <td>No</td>
                    }
                    <td>@order.Status</td>
                    <td><a href="javascript:GetRestaurantDetails('@order.Restaurant.Email')" style="color: blue">@order.Restaurant.Name</a></td>
                    <td><a href="javascript:GetCustomerDetails('@order.Customer.ID.ToString()')" style="color: blue">@order.Customer.FirstName @order.Customer.LastName </a></td>
                </tr>
            }
        </tbody>
    </table>

    <br>

    <h1>Delivered Orders</h1>

    <br>
    <table id="deliveredOrdersTable" class="table table-bordered table-striped" style="width:100%">
        <thead>
            <tr>
                <th><b>Order ID</b></th>
                <th><b>Received At</b></th>
                <th><b>Estimated Pickup Time</b></th>
                <th><b>Ready for Pickup</b></th>
                <th><b>Status</b></th>
                <th><b>Restaurant</b></th>
                <th><b>Customer</b></th>
            </tr>
        </thead>
        <tbody>
            @foreach (Order order in ViewBag.allDeliveredOrders)
            {
                <tr>
                    <td><a href="javascript:GetOrderDetails('@order.ID.ToString()')" style="color: blue">@order.ID</a></td>
                    <td>@order.DateTime</td>
                    <td>@order.PickupTime</td>

                    @if (@order.ReadyForPickup)
                    {
                        <td>Yes</td>
                    }
                    else
                    {
                        <td>No</td>
                    }
                    <td>@order.Status</td>
                    <td><a href="javascript:GetRestaurantDetails('@order.Restaurant.Email')" style="color: blue">@order.Restaurant.Name</a></td>
                    <td><a href="javascript:GetCustomerDetails('@order.Customer.ID.ToString()')" style="color: blue">@order.Customer.FirstName @order.Customer.LastName </a></td>
                </tr>
            }
        </tbody>
    </table>

    <br>
    <h1>Canceled Orders</h1>

    <br>
    <table id="canceledOrdersTable" class="table table-bordered table-striped" style="width:100%">
        <thead>
            <tr>
                <th><b>Order ID</b></th>
                <th><b>Received At</b></th>
                <th><b>Estimated Pickup Time</b></th>
                <th><b>Ready for Pickup</b></th>
                <th><b>Status</b></th>
                <th><b>Restaurant</b></th>
                <th><b>Customer</b></th>
            </tr>
        </thead>
        <tbody>
            @foreach (Order order in ViewBag.allCanceledOrders)
            {
                <tr>
                    <td><a href="javascript:GetOrderDetails('@order.ID.ToString()')" style="color: blue">@order.ID</a></td>
                    <td>@order.DateTime</td>
                    <td>@order.PickupTime</td>

                    @if (@order.ReadyForPickup)
                    {
                        <td>Yes</td>
                    }
                    else
                    {
                        <td>No</td>
                    }
                    <td>@order.Status</td>
                    <td><a href="javascript:GetRestaurantDetails('@order.Restaurant.Email')" style="color: blue">@order.Restaurant.Name</a></td>
                    <td><a href="javascript:GetCustomerDetails('@order.Customer.ID.ToString()')" style="color: blue">@order.Customer.FirstName @order.Customer.LastName </a></td>
                </tr>
            }
        </tbody>
    </table>

    <input type="button" value="Test Maps" class="register_btn" onclick="testAPI()" style="width: 200px" />



    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        Launch demo modal
    </button>

    <!-- Modal -->
    <div class="modal fade" id="AddParkingDialog" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>some content</p>
                    <input type="text" name="orderId" id="orderId" value="" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
   
   

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

    <script>$(document).on("click", ".open-AddParkingDialog", function () {
            var orderId = $(this).data('id');
            $(".modal-body #orderId").val(orderId);
            // As pointed out in comments,
            // it is unnecessary to have to manually call the modal.
            // $('#addBookDialog').modal('show');
        });</script>
    <script>$(document).ready(function () {
            $('#pendingOrdersTable').DataTable();
        });</script>
    <script>$(document).ready(function () {
            $('#deliveredOrdersTable').DataTable();
        });</script>
    <script>$(document).ready(function () {
            $('#inProgressOrdersTable').DataTable();
        });</script>
    <script>$(document).ready(function () {
            $('#canceledOrdersTable').DataTable();
        });</script>
    <script>function GetRestaurantDetails(restaurantEmail) {
        $.ajax({
            type: "POST",
            url: "/ViewRestaurant/GoToViewRestaurant",
            async: true,
            dataType: "json",
            data: { restaurantEmail: restaurantEmail },
            success: function (data) {
                if (data.errMsg != "") {
                    alert(String(data.errMsg));
                } else {
                    window.location.href = '/ViewRestaurant/Index';
                }
            },
            error: function () {
                return "error";
            }
        });
    }

    function GetCustomerDetails(customerID) {
        $.ajax({
            type: "POST",
            url: "/ViewCustomer/GoToViewCustomer",
            async: true,
            dataType: "json",
            data: { customerID: customerID },
            success: function (data) {
                if (data.errMsg != "") {
                    alert(String(data.errMsg));
                } else {
                    window.location.href = '/ViewCustomer/Index';
                }
            },
            error: function () {
                return "error";
            }
        });
    }

    function GetOrderDetails(orderID) {
        $.ajax({
            type: "POST",
            url: "/ViewOrder/GoToViewOrder",
            async: true,
            dataType: "json",
            data: { orderID: orderID },
            success: function (data) {
                if (data.errMsg != "") {
                    alert(String(data.errMsg));
                } else {
                    window.location.href = '/ViewOrder/Index';
                }
            },
            error: function () {
                return "error";
            }
        });
    }
    function Logout() {
        $.ajax({
            type: "POST",
            url: "/Login/Logout",
            async: true,
            dataType: "json",
            data: {},
            success: function (data) {
                window.location.href = '/Login/Index';
            }
        });
    }

    function GoMainMenu() {
        $.ajax({
            type: "POST",
            url: "/MainMenu/GoMainMenu",
            async: true,
            dataType: "json",
            data: {},
            success: function (data) {
                if (data.errMsg != "") {
                    alert(String(data.errMsg));
                } else {
                    window.location.href = '/MainMenu/Index';
                }
            },
            error: function () {
                return "error";
            }
        });
    }
    function AddOrder() {
        $.ajax({
            type: "POST",
            url: "/AddOrder/GoToAddOrder",
            async: true,
            dataType: "json",
            data: {},
            success: function (data) {
                window.location.href = '/AddOrder/Index';
            }
        });
    }

    function testAPI() {


        @*const body = '{"coordinates":[[43.0588647918687, -89.40034963890459],[43.067906818785985, -89.41057272700718]]}';*@


        var request = new XMLHttpRequest();

        request.open('GET', 'https://api.openrouteservice.org/v2/directions/foot-walking?api_key=5b3ce3597851110001cf62488303e1e1bcb64deb91105af7032e30d4&start=-89.43481627077286,43.08957898010592&end=-89.40057767677146,43.05885104655657');

        request.setRequestHeader('Accept', 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8');

        request.onreadystatechange = function () {
            if (this.readyState === 4) {
                @*console.log('Status:', this.status);*@
                @*console.log('Headers:', this.getAllResponseHeaders());*@
                @*console.log('Body:', this.responseText);*@
                const bodyJson = JSON.parse(this.responseText);
                console.log('Distance in km:', bodyJson.features[0].properties.summary.distance/1000);
                console.log('Duration in minutes:', bodyJson.features[0].properties.summary.duration/60);
            }
        };

        request.send();
    }

    </script>


</body>
</html>

